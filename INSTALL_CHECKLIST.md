# SOICO 証券CTA プラグイン - インストールチェックリスト

## 📋 インストール前の準備

- [ ] WordPress 6.0以上であることを確認
- [ ] PHP 7.4以上であることを確認
- [ ] SWELLテーマがインストール済み（推奨）
- [ ] サイトのバックアップを取得

---

## 📦 インストール手順

### Step 1: ファイルのアップロード

- [ ] `soico-securities-cta` フォルダを `/wp-content/plugins/` にアップロード
- [ ] フォルダ構成が正しいことを確認：

```
wp-content/plugins/soico-securities-cta/
├── soico-securities-cta.php      # メインプラグインファイル（457行）
├── README.md                     # 使用方法ドキュメント
├── INSTALL_CHECKLIST.md          # 本チェックリスト
├── REQUIREMENTS_SPECIFICATION.md # 要件定義書
├── DEVELOPMENT_PROMPT.md         # 開発継続用プロンプト
├── includes/
│   ├── blocks/                   # Block Loader アーキテクチャ
│   │   ├── class-block-base.php          # ブロック基底クラス（9KB）
│   │   ├── class-block-loader.php        # ブロックローダー（11KB）
│   │   ├── class-block-conclusion-box.php    # 結論ボックス（6.5KB）
│   │   ├── class-block-inline-cta.php        # インラインCTA（7KB）
│   │   ├── class-block-comparison-table.php  # 比較表（9.5KB）
│   │   ├── class-block-single-button.php     # 単体ボタン（6.5KB）
│   │   └── class-block-subtle-banner.php     # 控えめバナー（6KB）
│   ├── class-admin-settings.php  # 管理画面設定（27KB, 3ページ構成）
│   ├── class-auto-insert.php     # CTA自動挿入（7.5KB）
│   └── class-thirsty-affiliate.php # ThirstyAffiliates連携（8.5KB）
├── templates/
│   └── exit-popup.php            # 離脱ポップアップテンプレート（5KB）
└── assets/
    ├── css/
    │   ├── editor.css            # エディター用スタイル
    │   └── frontend.css          # フロントエンド用スタイル（15KB合計）
    └── js/
        ├── admin.js              # 管理画面用JS
        ├── editor.js             # Gutenbergエディター用JS（42KB）
        └── frontend.js           # フロントエンド用JS（ポップアップ等）
```

### Step 2: プラグインの有効化

- [ ] WordPress管理画面 → プラグイン に移動
- [ ] 「SOICO 証券CTA」を見つける
- [ ] 「有効化」をクリック
- [ ] エラーメッセージが出ないことを確認

### Step 3: 初期設定（3つの設定ページ）

#### 3-1. 基本設定（証券CTA → 基本設定）
- [ ] 管理画面左メニューに「証券CTA」が表示されることを確認
- [ ] 「証券CTA」→「基本設定」を開く
- [ ] メインカラー（デフォルト: #FF6B35）を確認
- [ ] サブカラー（デフォルト: #1E88E5）を確認
- [ ] PR表記テキストを確認（デフォルト: PR）
- [ ] 「設定を保存」をクリック

#### 3-2. リンク設定（証券CTA → リンク設定）
- [ ] 「証券CTA」→「リンク設定」を開く
- [ ] ThirstyAffiliates連携 または 手動URLを設定
- [ ] 「設定を保存」をクリック

#### 3-3. 自動挿入設定（証券CTA → 自動挿入設定）
- [ ] 「証券CTA」→「自動挿入設定」を開く
- [ ] 結論ボックス自動挿入の設定を確認
- [ ] CVキーワードを確認
- [ ] 「設定を保存」をクリック

---

## 🔗 ThirstyAffiliates設定（推奨）

### ThirstyAffiliatesがインストール済みの場合

- [ ] 「ThirstyAffiliates」→「アフィリエイトリンク」→「新規追加」

**作成するリンク（優先順位順）：**

| 優先度 | 証券会社 | スラッグ | CV報酬 | ステータス |
|-------|---------|---------|--------|-----------|
| 1 | SBI証券 | `sbi-securities` | 5,000円 | - [ ] 作成済み |
| 2 | マネックス証券 | `monex-securities` | 特別単価進行中 | - [ ] 作成済み |
| 3 | 楽天証券 | `rakuten-securities` | 通常単価 | - [ ] 作成済み |
| 4 | 岡三オンライン | `okasan-online` | 通常単価 | - [ ] 作成済み |

> **重要**: スラッグは完全一致する必要があります。大文字小文字に注意してください。

### ThirstyAffiliatesを使用しない場合

- [ ] 「証券CTA」→「リンク設定」を開く
- [ ] 各証券会社のURLを手動入力
- [ ] 「設定を保存」をクリック

---

## ✅ 動作確認

### ブロックエディター確認

- [ ] 新規投稿を作成
- [ ] ブロック追加（+）をクリック
- [ ] 「soico」で検索
- [ ] 5種類のブロックが表示されることを確認：
  - [ ] 結論ボックス（conclusion-box）
  - [ ] インラインCTA（inline-cta）
  - [ ] 比較表（comparison-table）
  - [ ] 単体ボタン（single-button）
  - [ ] 控えめバナー（subtle-banner）

### 各ブロックの動作確認

#### 結論ボックス（CVキーワード記事冒頭用）
- [ ] ブロックを挿入
- [ ] サイドバーで証券会社を変更できることを確認
- [ ] バッジ表示トグルが動作することを確認
- [ ] ボタンテキストが編集できることを確認
- [ ] カスタムタイトルが設定できることを確認
- [ ] プレビューでグラデーション背景が表示されることを確認

#### インラインCTA（本文中用）
- [ ] ブロックを挿入
- [ ] 証券会社の変更が反映されることを確認
- [ ] スタイル変更（default/compact）が動作することを確認
- [ ] フロントエンドで正しく表示されることを確認

#### 比較表（証券会社比較用）
- [ ] ブロックを挿入
- [ ] 表示件数の変更が反映されることを確認
- [ ] 証券会社が優先順位順（SBI→マネックス→楽天→岡三）に表示されることを確認
- [ ] 1位のSBI証券がハイライトされていることを確認

#### 単体ボタン（セクション末尾用）
- [ ] ブロックを挿入
- [ ] 配置（左/中央/右）の変更が反映されることを確認
- [ ] ボタンテキストの変更が反映されることを確認
- [ ] PR表記トグルが動作することを確認

#### 控えめバナー（情報系記事目次上用）
- [ ] ブロックを挿入
- [ ] アイコン表示トグルが動作することを確認
- [ ] カスタムテキストが設定できることを確認
- [ ] コンパクトに表示されることを確認

### フロントエンド確認

- [ ] 作成した記事を公開
- [ ] フロントエンドで各ブロックが正しく表示されることを確認
- [ ] CTAボタンをクリックしてリンク先に移動することを確認
- [ ] モバイル表示でレイアウトが崩れないことを確認
- [ ] PR表記が表示されていることを確認
- [ ] デザイン色が設定通りか確認（ボタン: #FF6B35、ボーダー: #1E88E5）

### Exit-Intentポップアップ確認

- [ ] 「証券CTA」→「基本設定」→「Exit-Intent ポップアップを有効化」をON
- [ ] ポップアップ表示遅延（デフォルト: 30秒）を確認
- [ ] ポップアップ表示証券会社（デフォルト: SBI証券）を確認
- [ ] 「設定を保存」をクリック

**デスクトップ動作確認：**
- [ ] フロントエンドでページを表示
- [ ] マウスをブラウザ上部から外に移動（Y座標 < 10px）
- [ ] ポップアップが表示されることを確認
- [ ] 閉じるボタン（×）が動作することを確認
- [ ] 「後で見る」ボタンが動作することを確認
- [ ] 24時間以内に再表示されないことを確認（localStorage確認）

**モバイル動作確認：**
- [ ] モバイルデバイスでページを表示
- [ ] 30秒後（設定値）にポップアップが表示されることを確認
- [ ] タップで閉じられることを確認

### 自動挿入確認（オプション）

- [ ] 「証券CTA」→「自動挿入設定」を開く
- [ ] 「結論ボックスを自動挿入」をON
- [ ] CVキーワード設定を確認（デフォルト: 口座開設,始め方,おすすめ,比較,ランキング,SBI証券,楽天証券,マネックス証券）
- [ ] 「設定を保存」をクリック
- [ ] タイトルに「口座開設」を含む記事を作成
- [ ] プレビューで結論ボックスが目次前に自動挿入されることを確認

### トラッキング確認（GA4/GTM連携）

- [ ] ブラウザの開発者ツールを開く（F12）
- [ ] Consoleタブを選択
- [ ] CTAボタンをクリック
- [ ] `dataLayer.push` が実行されることを確認
- [ ] 送信されるイベント形式を確認：
  ```javascript
  {
    event: 'cta_click',
    cta_company: 'sbi',          // 証券会社キー
    cta_block_type: 'conclusion-box', // ブロックタイプ
    cta_position: 'header'       // 配置位置
  }
  ```
- [ ] GA4でイベントが記録されることを確認（数時間後）

---

## 🚨 トラブルシューティング

### 問題: ブロックが表示されない

**確認項目：**
- [ ] プラグインが有効化されているか
- [ ] JavaScriptエラーがないか（開発者ツールで確認）
- [ ] 他のプラグインとの競合がないか
- [ ] Block Loaderがブロックを検出しているか（PHPエラーログ確認）

**対処法：**
1. ブラウザキャッシュをクリア
2. WordPressのキャッシュをクリア
3. 他のプラグインを一時無効化してテスト
4. `wp-content/debug.log` でエラーを確認

### 問題: スタイルが崩れる

**確認項目：**
- [ ] CSSファイルが読み込まれているか（開発者ツールのNetworkタブ）
- [ ] SWELLテーマのバージョン
- [ ] 他のプラグインのCSSとの競合

**対処法：**
1. テーマのキャッシュをクリア
2. 必要に応じてカスタムCSSで調整
3. CSSの読み込み順を確認

### 問題: アフィリエイトリンクが動作しない

**確認項目：**
- [ ] ThirstyAffiliatesのスラッグが完全一致しているか
  - `sbi-securities`
  - `monex-securities`
  - `rakuten-securities`
  - `okasan-online`
- [ ] 手動URLが正しく設定されているか
- [ ] REST APIエンドポイントが動作しているか

**対処法：**
1. 「リンク設定」タブで「キャッシュをクリア」
2. スラッグを再確認（大文字小文字注意）
3. 手動URLをフォールバックとして設定
4. REST API確認: `https://yoursite.com/wp-json/soico-cta/v1/affiliate-links`

### 問題: Exit-Intentポップアップが表示されない

**確認項目：**
- [ ] 「基本設定」で有効化されているか
- [ ] ブラウザのlocalStorageを確認（24時間制御）
- [ ] モバイルの場合は遅延時間を待っているか

**対処法：**
1. 開発者ツール → Application → Local Storage → 該当キーを削除
2. シークレットモードでテスト
3. frontend.jsが読み込まれているか確認

---

## 📊 最終確認

- [ ] すべてのブロックが正常に動作する
- [ ] アフィリエイトリンクが正しく設定されている（優先度順: SBI > マネックス > 楽天 > 岡三）
- [ ] Exit-Intentポップアップが動作する（有効化時）
- [ ] モバイル表示が正常
- [ ] PR表記が表示されている（コンプライアンス対応）
- [ ] トラッキングが動作している
- [ ] 自動挿入が意図通り動作している

---

## 🛠️ 開発者向け情報

### Block Loader アーキテクチャ

本プラグインは「Block Loader」パターンを採用しています。新しいブロックを追加する場合：

1. `includes/blocks/` に `class-block-{name}.php` を作成
2. `SOICO_CTA_Block_Base` を継承
3. 必須メソッドを実装：
   - `get_name()` - ブロック名（例: 'my-block'）
   - `get_title()` - 表示タイトル（例: 'マイブロック'）
   - `get_attributes()` - ブロック属性定義
   - `render()` - HTMLレンダリング
4. Block Loaderが自動検出・登録（手動登録不要）
5. `assets/js/editor.js` に対応するGutenbergブロック定義を追加

### REST APIエンドポイント

| エンドポイント | 説明 |
|--------------|------|
| `/wp-json/soico-cta/v1/affiliate-links` | アフィリエイトリンク取得 |
| `/wp-json/soico-cta/v1/securities` | 証券会社データ取得 |

### 設定オプションキー

| オプションキー | 説明 | デフォルト値 |
|--------------|------|------------|
| `soico_cta_primary_color` | メインカラー | #FF6B35 |
| `soico_cta_secondary_color` | サブカラー | #1E88E5 |
| `soico_cta_pr_label` | PR表記テキスト | PR |
| `soico_cta_enable_exit_popup` | ポップアップ有効化 | false |
| `soico_cta_exit_popup_delay` | ポップアップ遅延（秒） | 30 |
| `soico_cta_exit_popup_company` | ポップアップ表示証券会社 | sbi |
| `soico_cta_auto_insert_conclusion` | 結論ボックス自動挿入 | false |
| `soico_cta_cv_keywords` | CVキーワード（カンマ区切り） | 口座開設,始め方,... |

---

## 🎉 インストール完了！

上記すべてのチェックが完了したら、プラグインは正常にインストールされています。

### 次のステップ

1. 既存記事にCTAブロックを追加
2. 自動挿入設定の調整
3. A/Bテストの実施（別途設計）
4. 効果測定の開始
5. FUNDiT連携の検討（次フェーズ）

---

## 📞 サポート連絡先

問題が解決しない場合は、以下の情報を添えてお問い合わせください：

- WordPressバージョン
- PHPバージョン
- テーマ名とバージョン
- エラーメッセージ（あれば）
- 問題が発生する操作の詳細
- ブラウザの開発者ツールのConsoleログ
- `wp-content/debug.log` の内容（該当部分）

---

## 📋 更新履歴

| 日付 | バージョン | 変更内容 |
|-----|----------|---------|
| 2024-12-25 | v1.1 | Block Loaderアーキテクチャ対応、開発者向け情報追加 |
| 2024-12-24 | v1.0 | 初版作成 |
